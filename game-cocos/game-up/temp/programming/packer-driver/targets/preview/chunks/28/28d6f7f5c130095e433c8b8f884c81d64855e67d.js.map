{"version":3,"sources":["file:///Users/chenchao/code/person/game-upgradation/game-cocos/game-up/assets/iogame/RequestCommand.ts"],"names":["RequestCommand","SocketClient","encodeExternalMessage","CmdMgr","HandleMgr","hashFun","LogUtils","init","client","SC","constructor","mainCmdCode","subCmdCode","data","callback","title","execute","mergeCmd","getMergeCmd","callHash","log","addHandler","msg","cmdCode","protocolSwitch","cmdMerge","responseStatus","validMsg","msgId","ins","send","counter"],"mappings":";;;yGAQqBA,c;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAPdC,MAAAA,Y;;AACCC,MAAAA,qB,iBAAAA,qB;;AACDC,MAAAA,M;;AACAC,MAAAA,S;;AACCC,MAAAA,O,iBAAAA,O;;AACDC,MAAAA,Q;;;;;;;yBAEcN,c,GAAN,MAAMA,cAAN,CAAqB;AAKrB,eAAJO,IAAI,CAACC,MAAD,EAAkB;AACzB,eAAKC,EAAL,GAAUD,MAAV;AACH;;AAQDE,QAAAA,WAAW,CAACC,WAAD,EAAsBC,UAAtB,EAA0CC,IAA1C,EAA0DC,QAA1D,EAA8E;AAAA,eANzFC,KAMyF,GANzE,gBAMyE;AAAA,eALzFJ,WAKyF,GALnE,CAKmE;AAAA,eAJzFC,UAIyF,GAJpE,CAIoE;AAAA,eAHzFC,IAGyF,GAHxE,IAGwE;AAAA,eAFzFC,QAEyF,GAFpE,IAEoE;AACrF,eAAKH,WAAL,GAAmBA,WAAnB;AACA,eAAKC,UAAL,GAAkBA,UAAlB;AACA,eAAKC,IAAL,GAAYA,IAAZ;AACA,eAAKC,QAAL,GAAgBA,QAAhB;AACH;;AAEME,QAAAA,OAAO,GAAS;AACnB;AACA,cAAIC,QAAQ,GAAG;AAAA;AAAA,gCAAOC,WAAP,CAAmB,KAAKP,WAAxB,EAAqC,KAAKC,UAA1C,CAAf;AACA,cAAIO,QAAQ,GAAG;AAAA;AAAA,kCAAQ,KAAKL,QAAb,CAAf;AACA;AAAA;AAAA,oCAASM,GAAT,CAAa,UAAb,EAAyBD,QAAzB;AACA;AAAA;AAAA,sCAAUE,UAAV,CAAqBJ,QAArB,EAA+B,KAAKH,QAApC;AAEA,cAAIQ,GAAG,GAAG;AACNC,YAAAA,OAAO,EAAE,CADH;AAENC,YAAAA,cAAc,EAAE,CAFV;AAGNC,YAAAA,QAAQ,EAAER,QAHJ;AAINS,YAAAA,cAAc,EAAE,CAJV;AAKNC,YAAAA,QAAQ,EAAE,EALJ;AAMNC,YAAAA,KAAK,EAAET,QAND;AAONN,YAAAA,IAAI,EAAE,KAAKA,IAAL;AAPA,WAAV;AASA;AAAA;AAAA,4CAAagB,GAAb,CAAiBC,IAAjB,CAAsB;AAAA;AAAA,8DAAsBR,GAAtB,CAAtB;AACH;;AAvC+B,O;;AAChC;AADiBtB,MAAAA,c,CAEVS,E,GAAc,I;AAFJT,MAAAA,c,CAGV+B,O,GAAkB,C","sourcesContent":["import ISocket from \"db://assets/iogame/ISocket\";\nimport SocketClient from \"db://assets/iogame/SocketClient\";\nimport {encodeExternalMessage} from \"db://assets/iogame/pb/ExternalMessage\";\nimport CmdMgr from \"db://assets/iogame/cmd/CmdMgr\";\nimport HandleMgr from \"db://assets/iogame/HandleMgr\";\nimport {hashFun} from \"db://assets/iogame/HashUtils\";\nimport LogUtils from \"db://assets/iogame/LogUtils\";\n\nexport default class RequestCommand {\n    // 多实例方式，避免连多个问题\n    static SC: ISocket = null;\n    static counter: number = 0;\n\n    static init(client: ISocket) {\n        this.SC = client;\n    }\n\n    title: string = \"RequestCommand\";\n    mainCmdCode: number = 0;\n    subCmdCode: number = 0;\n    data: Function = null;\n    callback: Function = null;\n\n    constructor(mainCmdCode: number, subCmdCode: number, data: Function, callback: Function) {\n        this.mainCmdCode = mainCmdCode;\n        this.subCmdCode = subCmdCode;\n        this.data = data;\n        this.callback = callback;\n    }\n\n    public execute(): void {\n        // 执行\n        let mergeCmd = CmdMgr.getMergeCmd(this.mainCmdCode, this.subCmdCode)\n        let callHash = hashFun(this.callback)\n        LogUtils.log(\"callHash\", callHash)\n        HandleMgr.addHandler(mergeCmd, this.callback);\n\n        let msg = {\n            cmdCode: 1,\n            protocolSwitch: 0,\n            cmdMerge: mergeCmd,\n            responseStatus: 0,\n            validMsg: \"\",\n            msgId: callHash,\n            data: this.data()\n        }\n        SocketClient.ins.send(encodeExternalMessage(msg));\n    }\n\n}\n"]}